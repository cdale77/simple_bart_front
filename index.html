<!-- index.html -->
<html>
  <head>
    <title>Find Trains!</title>
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  </head>
  <body>
    <div id="content">
    </div>
    <script type="text/jsx">
      
      var stationList = [
        { value: "12th", label:  "12th St. Oakland City Center" },
        { value: "16th", label:  "16th St. Mission (SF)" },
        { value: "19th", label:  "19th St. Oakland" },
        { value: "24th", label:  "24th St. Mission (SF)" },
        { value: "ashb", label:  "Ashby (Berkeley)" },
        { value: "balb", label:  "Balboa Park (SF)" },
        { value: "bayf", label:  "Bay Fair (San Leandro)" },
        { value: "cast", label:  "Castro Valley" },
        { value: "civc", label:  "Civic Center (SF)" },
        { value: "cols", label:  "Coliseum/Oakland Airport" },
        { value: "colm", label:  "Colma" },
        { value: "conc", label:  "Concord" },
        { value: "daly", label:  "Daly City" },
        { value: "dbrk", label:  "Downtown Berkeley" },
        { value: "dubl", label:  "Dublin/Pleasanton" },
        { value: "deln", label:  "El Cerrito del Norte" },
        { value: "plza", label:  "El Cerrito Plaza" },
        { value: "embr", label:  "Embarcadero (SF)" },
        { value: "frmt", label:  "Fremont" },
        { value: "ftvl", label:  "Fruitvale (Oakland)" },
        { value: "glen", label:  "Glen Park (SF)" },
        { value: "hayw", label:  "Hayward" },
        { value: "lafy", label:  "Lafayette" },
        { value: "lake", label:  "Lake Merritt (Oakland)" },
        { value: "mcar", label:  "MacArthur (Oakland)" },
        { value: "mlbr", label:  "Millbrae" },
        { value: "mont", label:  "Montgomery St. (SF)" },
        { value: "nbrk", label:  "North Berkeley" },
        { value: "ncon", label:  "North Concord/Martinez" },
        { value: "orin", label:  "Orinda" },
        { value: "pitt", label:  "Pittsburg/Bay Point" },
        { value: "phil", label:  "Pleasant Hill" },
        { value: "powl", label:  "Powell St. (SF)" },
        { value: "rich", label:  "Richmond" },
        { value: "rock", label:  "Rockridge (Oakland)" },
        { value: "sbrn", label:  "San Bruno" },
        { value: "sfia", label:  "San Francisco Int'l Airport" },
        { value: "sanl", label:  "San Leandro" },
        { value: "shay", label:  "South Hayward" },
        { value: "ssan", label:  "South San Francisco" },
        { value: "ucty", label:  "Union City" },
        { value: "wcrk", label:  "Walnut Creek" },
        { value: "woak", label:  "West Oakland" }
       ];

        var TrainBox = React.createClass({
        getInitialState: function() {
          return {data: []};
        },
        handleSubmit: function(stationObject) {
          $.ajax({
            url: this.props.url + stationObject.station1,
            dataType: 'json',
            success: function(data) {
              this.setState({data: data});
            }.bind(this),
            error: function(xhr, status, err) {
              console.error(this.props.url, status, error.toString());
            }.bind(this)
          });
        },
        render: function() {
          return (
            <div className="infoBox">
              <StationSelectForm onSubmit={this.handleSubmit} />
              <DepartureList data={this.state.data} />
            </div>
          );
        }
      });

      var DepartureList = React.createClass({
        render: function() {
          var departureListings = [];
          for(var departureSet in this.props.data) {
            departureListings.push(
              <DepartureListing
              name={this.props.data[departureSet].destination_name}
              length={this.props.data[departureSet].estimates.length}
              arriving_in={this.props.data[departureSet].estimates.minutes}
              platform={this.props.data[departureSet].estimates.platform} />
              );
          };
          return (
            <div className="departureList">
              {departureListings}
            </div>
          );
        }
      });

      var DepartureListing = React.createClass({
        render: function() {
          return (
            <div className="departureListing">
              <h3>Departure</h3>
              Destination: {this.props.name}<br />
              Length: {this.props.length}<br />
              Arriving: {this.props.arriving_in}<br />
              Platform: {this.props.platform}
            </div>
          );
        }
      });

      var StationSelectForm = React.createClass({
        handleSubmit: function(e) {
          e.preventDefault();
          var station1 = this.refs.station1.getDOMNode().value.trim();
          var station2 = this.refs.station2.getDOMNode().value.trim();
          this.props.onSubmit({station1: station1, station2: station2});
        },
        render: function() {
  
          return (
            <form className="stationSelectForm" onSubmit={this.handleSubmit} >
              <label htmlFor="station1">Departure</label>
              <select ref="station1" >
              {stationList.map(function(station) {
                return <option value={station.value}>{station.label}</option>
              })}
              </select><br />
              <label htmlFor="station2">Destination</label>
              <select ref="station2">
                <option disabled selected></option>
                {stationList.map(function(station) {
                 return <option value={station.value}>{station.label}</option>
                })}
                 </select>
              <input type="submit" value="Find Trains" />
            </form>
          );
        }
      });

      React.render(
        <TrainBox url="http://simple-bart-api.herokuapp.com/departures/" />,
        document.getElementById("content")
      );
    </script>
  </body>
</html>
