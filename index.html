<!-- index.html -->
<html>
  <head>
    <title>Find Trains!</title>
    <script src="http://fb.me/react-0.12.2.js"></script>
    <script src="http://fb.me/JSXTransformer-0.12.2.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
  </head>
  <body>
    <div id="content">
    </div>
    <script type="text/jsx">

      var TrainBox = React.createClass({
        getInitialState: function() {
          return {data: []};
        },
        handleSubmit: function(station) {
        console.log(station);
          $.ajax({
            url: this.props.url + station.station,
            dataType: 'json',
            success: function(data) {
              this.setState({data: data});
            }.bind(this),
            error: function(xhr, status, err) {
              console.error(this.props.url, status, error.toString());
              }.bind(this)
          });
        },
        render: function() {
          return (
            <div className="infoBox">
              <StationSelectForm onSubmit={this.handleSubmit} />
              <DepartureList data={this.state.data} />
            </div>
          );
        }
      });

      var DepartureList = React.createClass({
        render: function() {
          var departureListings = [];
          for(var departureSet in this.props.data) {
            departureListings.push(
              <DepartureListing
              name={this.props.data[departureSet].destination_name}
              length={this.props.data[departureSet].estimates.length}
              arriving_in={this.props.data[departureSet].estimates.minutes}
              platform={this.props.data[departureSet].estimates.platform} />
              );
          };
          return (
            <div className="departureList">
              {departureListings}
            </div>
          );
        }
      });

      var DepartureListing = React.createClass({
        render: function() {
          return (
            <div className="departureListing">
              <h3>Departure</h3>
              Destination: {this.props.name}<br />
              Length: {this.props.length}<br />
              Arriving: {this.props.arriving_in}<br />
              Platform: {this.props.platform}
            </div>
          );
        }
      });

      var StationSelectForm = React.createClass({
        handleSubmit: function(e) {
          e.preventDefault();
          var station = this.refs.station.getDOMNode().value.trim();
          this.props.onSubmit({station: station});
        },
        render: function() {
          return (
            <form className="stationSelectForm" onSubmit={this.handleSubmit} >
              <select ref="station">
                <option value='12th'>12th St. Oakland City Center</option>
                <option value='16th'>16th St. Mission (SF)</option>
                <option value='19th'>19th St. Oakland</option>
                <option value='24th'>24th St. Mission (SF)</option>
                <option value='ashb'>Ashby (Berkeley)</option>
                <option value='balb'>Balboa Park (SF)</option>
                <option value='bayf'>Bay Fair (San Leandro)</option>
                <option value='cast'>Castro Valley</option>
                <option value='civc'>Civic Center (SF)</option>
                <option value='cols'>Coliseum/Oakland Airport</option>
                <option value='colm'>Colma</option>
                <option value='conc'>Concord</option>
                <option value='daly'>Daly City</option>
                <option value='dbrk'>Downtown Berkeley</option>
                <option value='dubl'>Dublin/Pleasanton</option>
                <option value='deln'>El Cerrito del Norte</option>
                <option value='plza'>El Cerrito Plaza</option>
                <option value='embr'>Embarcadero (SF)</option>
                <option value='frmt'>Fremont</option>
                <option value='ftvl'>Fruitvale (Oakland)</option>
                <option value='glen'>Glen Park (SF)</option>
                <option value='hayw'>Hayward</option>
                <option value='lafy'>Lafayette</option>
                <option value='lake'>Lake Merritt (Oakland)</option>
                <option value='mcar'>MacArthur (Oakland)</option>
                <option value='mlbr'>Millbrae</option>
                <option value='mont'>Montgomery St. (SF)</option>
                <option value='nbrk'>North Berkeley</option>
                <option value='ncon'>North Concord/Martinez</option>
                <option value='orin'>Orinda</option>
                <option value='pitt'>Pittsburg/Bay Point</option>
                <option value='phil'>Pleasant Hill</option>
                <option value='powl'>Powell St. (SF)</option>
                <option value='rich'>Richmond</option>
                <option value='rock'>Rockridge (Oakland)</option>
                <option value='sbrn'>San Bruno</option>
                <option value='sfia'>San Francisco Int'l Airport</option>
                <option value='sanl'>San Leandro</option>
                <option value='shay'>South Hayward</option>
                <option value='ssan'>South San Francisco</option>
                <option value='ucty'>Union City</option>
                <option value='wcrk'>Walnut Creek</option>
                <option value='woak'>West Oakland</option>  
              </select>
              <input type="submit" value="Find Trains" />
            </form>
          );
        }
      });
    
      React.render(
        <TrainBox url="http://simple-bart-api.herokuapp.com/departures/" />,
        document.getElementById("content")
      );    
    </script>
  </body>
</html>
